local keywordHandler = KeywordHandler:new()
local npcHandler = NpcHandler:new(keywordHandler)
NpcSystem.parseParameters(npcHandler)

function onCreatureAppear(cid)
	npcHandler:onCreatureAppear(cid)
end
function onCreatureDisappear(cid)
	npcHandler:onCreatureDisappear(cid)
end
function onCreatureSay(cid, type, msg)
	npcHandler:onCreatureSay(cid, type, msg)
end
function onThink()
	npcHandler:onThink()
end

local shopModule = ShopModule:new()
npcHandler:addModule(shopModule)

shopModule:addBuyableItem({"almanac of magic"}, 10025, 729, 1)
shopModule:addBuyableItem({"animal fetish"}, 9236, 10000, 1)
shopModule:addBuyableItem({"baby rotworm"}, 10026, 729, 1)
shopModule:addBuyableItem({"bale of white cloth"}, 142, 6000, 1)
shopModule:addBuyableItem({"bill"}, 3216, 1038, 1)
shopModule:addBuyableItem({"blood crystal"}, 8453, 50000, 1)
shopModule:addBuyableItem({"bloodkiss flower"}, 9241, 10000, 1)
shopModule:addBuyableItem({"bundle of rags"}, 9191, 5000, 1)
shopModule:addBuyableItem({"carrying device"}, 9698, 1000, 1)
shopModule:addBuyableItem({"cigar"}, 141, 2000, 1)
shopModule:addBuyableItem({"cookbook"}, 3234, 150, 1)
shopModule:addBuyableItem({"damaged logbook"}, 6124, 35165, 1)
shopModule:addBuyableItem({"dark essence"}, 9238, 14814, 1)
shopModule:addBuyableItem({"deep crystal"}, 9240, 12013, 1)
shopModule:addBuyableItem({"elemental crystal"}, 9251, 1038, 1)
shopModule:addBuyableItem({"empty beer bottle"}, 138, 729, 1)
shopModule:addBuyableItem({"exploding cookie"}, 8111, 100, 1)
shopModule:addBuyableItem({"exquisite silk"}, 11545, 4000, 1)
shopModule:addBuyableItem({"exquisite wood"}, 11547, 4000, 1)
shopModule:addBuyableItem({"faded last will"}, 11544, 729, 1)
shopModule:addBuyableItem({"family brooch"}, 4834, 1000, 1)
shopModule:addBuyableItem({"family signet ring"}, 406, 15000, 1)
shopModule:addBuyableItem({"fan club membership card"}, 9391, 10000, 1)
shopModule:addBuyableItem({"filled carrying device"}, 9699, 1000, 1)
shopModule:addBuyableItem({"fishnapped goldfish"}, 7936, 7000, 1)
shopModule:addBuyableItem({"flask of crown polisher"}, 10009, 700, 1)
shopModule:addBuyableItem({"flask of extra greasy oil"}, 10189, 1000, 1)
shopModule:addBuyableItem({"flask of poison"}, 10183, 1000, 1)
shopModule:addBuyableItem({"flexible dragon scale"}, 11550, 4000, 1)
shopModule:addBuyableItem({"formula for a memory potion"}, 9188, 5000, 1)
shopModule:addBuyableItem({"funeral urn"}, 4847, 6000, 1)
shopModule:addBuyableItem({"ghost charm"}, 8822, 17720, 1)
shopModule:addBuyableItem({"ghost's tear"}, 8746, 50000, 1)
shopModule:addBuyableItem({"giant ape's hair"}, 4832, 21631, 1)
shopModule:addBuyableItem({"golem blueprint"}, 9247, 12511, 1)
shopModule:addBuyableItem({"golem head"}, 9255, 22344, 1)
shopModule:addBuyableItem({"headache pill"}, 9537, 350, 1)
shopModule:addBuyableItem({"ivory lyre"}, 31447, 5000, 1)
shopModule:addBuyableItem({"letterbag"}, 3217, 1038, 1)
shopModule:addBuyableItem({"lump of clay"}, 11329, 1000, 1)
shopModule:addBuyableItem({"machine crate"}, 9390, 7670, 1)
shopModule:addBuyableItem({"magic crystal"}, 11552, 4000, 1)
shopModule:addBuyableItem({"mago mechanic core"}, 9249, 12013, 1)
shopModule:addBuyableItem({"map to the unknown"}, 10011, 650, 1)
shopModule:addBuyableItem({"memory crystal"}, 7281, 500, 1)
shopModule:addBuyableItem({"memory stone"}, 4841, 3000, 1)
shopModule:addBuyableItem({"mystic root"}, 11551, 4000, 1)
shopModule:addBuyableItem({"nautical map"}, 9308, 5249, 1)
shopModule:addBuyableItem({"old iron"}, 11549, 4000, 1)
shopModule:addBuyableItem({"old power core"}, 9252, 12013, 1)
shopModule:addBuyableItem({"plans for a strange device"}, 9696, 1000, 1)
shopModule:addBuyableItem({"rare crystal"}, 10187, 1000, 1)
shopModule:addBuyableItem({"sacred earth"}, 11341, 1000, 1)
shopModule:addBuyableItem({"sceptre of sun and sea"}, 31414, 50000, 1)
shopModule:addBuyableItem({"shadow orb"}, 9237, 11544, 1)
shopModule:addBuyableItem({"sheet of tracing paper"}, 4843, 500, 1)
shopModule:addBuyableItem({"suspicious signet ring"}, 349, 15000, 1)
shopModule:addBuyableItem({"snake destroyer"}, 4835, 1038, 1)
shopModule:addBuyableItem({"soul contract"}, 10028, 666, 1)
shopModule:addBuyableItem({"special flask"}, 135, 5000, 1)
shopModule:addBuyableItem({"spectral cloth"}, 11546, 4000, 1)
shopModule:addBuyableItem({"spectral dress"}, 4836, 15000, 1)
shopModule:addBuyableItem({"spyreport"}, 3232, 3000, 1)
shopModule:addBuyableItem({"stabilizer"}, 9248, 11544, 1)
shopModule:addBuyableItem({"strange powder"}, 13974, 5000, 1)
shopModule:addBuyableItem({"strong sinew"}, 11548, 4000, 1)
shopModule:addBuyableItem({"tear of daraman"}, 3233, 14667, 1)
shopModule:addBuyableItem({"technomancer beard"}, 396, 5000, 1)
shopModule:addBuyableItem({"the alchemists' formulas"}, 8818, 1038, 1)
shopModule:addBuyableItem({"the ring of the count"}, 7924, 10000, 1)
shopModule:addBuyableItem({"toy mouse"}, 123, 14667, 1)
shopModule:addBuyableItem({"universal tool"}, 10027, 550, 1)
shopModule:addBuyableItem({"unworked sacred wood"}, 11339, 1000, 1)
shopModule:addBuyableItem({"whisper moss"}, 4827, 15468, 1)
shopModule:addBuyableItem({"worm queen tooth"}, 9239, 11544, 1)
shopModule:addBuyableItem({"wrinkled parchment"}, 4846, 4000, 1)
shopModule:addBuyableItem({"wolf tooth chain"}, 5940, 10000, 1)

local function onTradeRequest(cid)
	local player = Player(cid)
	if player:getStorageValue(Storage.ThievesGuild.Mission08) ~= 3 then
		npcHandler:say("I don't know you and I don't have any dealings with people whom I don't trust.", cid)
		return false
	end
	return true
end

npcHandler:setMessage(MESSAGE_GREET, "Hi there, |PLAYERNAME|! You look like you are eager to {trade}!")
npcHandler:setMessage(MESSAGE_FAREWELL, "Bye, |PLAYERNAME|")

npcHandler:setCallback(CALLBACK_ONTRADEREQUEST, onTradeRequest)
npcHandler:setCallback(CALLBACK_MESSAGE_DEFAULT, creatureSayCallback)

npcHandler:addModule(FocusModule:new())
